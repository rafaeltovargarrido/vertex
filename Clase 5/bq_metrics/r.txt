functions-framework==3.*
google-cloud-monitoring
google-cloud-bigquery




CREATE TABLE IF NOT EXISTS `formacionaiops-476808.metrics_export.cpu_usage_rate`
(
  timestamp TIMESTAMP,
  instance_id STRING,
  cpu_total_cores FLOAT64
)
PARTITION BY DATE(timestamp);

S√ç, es obligatorio. ‚ö†Ô∏è

El c√≥digo de Python que te he pasado usa el m√©todo insert_rows_json, que NO crea la tabla autom√°ticamente. Solo intenta meter datos en una tabla que ya existe. Si la tabla no est√° ah√≠, el script fallar√° con un error 404 Not Found.

Aqu√≠ tienes la consulta SQL exacta para crearla con la estructura perfecta para tu script.

Ejecuta esto en BigQuery ahora mismo:
Aseg√∫rate de cambiar metrics_export por el nombre de tu Dataset si es diferente.

SQL

CREATE TABLE IF NOT EXISTS `formacionaiops-476808.metrics_export.cpu_usage_rate`
(
  timestamp TIMESTAMP,
  instance_id STRING,
  cpu_total_cores FLOAT64
)
PARTITION BY DATE(timestamp);
¬øPor qu√© PARTITION BY?
He a√±adido la √∫ltima l√≠nea (PARTITION BY DATE(timestamp)) porque es una Best Practice cr√≠tica para m√©tricas:

Le dice a BigQuery que guarde los datos en "carpetas" diarias.

Cuando dentro de un mes quieras consultar "los datos de hoy", te costar√° much√≠simo menos dinero y ser√° m√°s r√°pido porque BigQuery solo leer√° la carpeta de hoy y no escanear√° todo el historial.

Una vez creada la tabla, ¬°ya puedes lanzar el Scheduler! üöÄ